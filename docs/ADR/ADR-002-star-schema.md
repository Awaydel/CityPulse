# ADR-002: Схема хранилища данных «Звезда»

## Статус

✅ Принято

## Контекст

Необходимо спроектировать схему базы данных для хранения:
- Справочной информации о городах
- Временных рядов погодных данных
- Временных рядов данных о качестве воздуха
- ML-прогнозов

## Решение

Используем схему **Star Schema** с одной таблицей измерений (`dim_city`) и двумя таблицами фактов (`fact_weather`, `fact_air_quality`).

## Обоснование

```
         dim_city (dimension)
              │
    ┌─────────┴─────────┐
    │                   │
fact_weather      fact_air_quality
  (facts)              (facts)
```

| Подход | Плюсы | Минусы |
|--------|-------|--------|
| Star Schema | Простые JOIN'ы, понятная структура | Дублирование city_id |
| Snowflake | Нормализация | Сложнее запросы |
| Одна таблица | Просто | Много NULL'ов, плохая масштабируемость |

## Последствия

### Положительные
- Оптимально для OLAP-запросов
- Легко добавлять новые города
- Чёткое разделение погоды и качества воздуха

### Отрицательные
- Нужны JOIN'ы для получения полных данных
- Дублирование timestamp в обеих таблицах фактов

## Реализация

`dm_dashboard_analytics` — VIEW для денормализации данных на уровне чтения.
