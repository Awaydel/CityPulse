# ğŸ”€ EcoSense: Data Flow Diagram (DFD) & System Architecture

---

## ğŸ“Š ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Data Flow Diagram)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          EXTERNAL DATA SOURCES                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â•‘
â•‘  â”‚ Open-Meteo Weather API   â”‚         â”‚ Open-Meteo AQ API        â”‚          â•‘
â•‘  â”‚                          â”‚         â”‚                          â”‚          â•‘
â•‘  â”‚ GET /v1/forecast         â”‚         â”‚ GET /v1/air-quality      â”‚          â•‘
â•‘  â”‚ Parameters:              â”‚         â”‚ Parameters:              â”‚          â•‘
â•‘  â”‚  - latitude, longitude   â”‚         â”‚  - latitude, longitude   â”‚          â•‘
â•‘  â”‚  - past_days=7           â”‚         â”‚  - past_days=7           â”‚          â•‘
â•‘  â”‚  - forecast_days=1       â”‚         â”‚  - forecast_days=1       â”‚          â•‘
â•‘  â”‚  - hourly metrics        â”‚         â”‚  - hourly pm10, pm2_5    â”‚          â•‘
â•‘  â”‚                          â”‚         â”‚                          â”‚          â•‘
â•‘  â”‚ Response: JSON           â”‚         â”‚ Response: JSON           â”‚          â•‘
â•‘  â”‚  - hourly.time[]         â”‚         â”‚  - hourly.time[]         â”‚          â•‘
â•‘  â”‚  - hourly.temperature[]  â”‚         â”‚  - hourly.pm10[]         â”‚          â•‘
â•‘  â”‚  - hourly.humidity[]     â”‚         â”‚  - hourly.pm2_5[]        â”‚          â•‘
â•‘  â”‚  - hourly.wind_speed[]   â”‚         â”‚                          â”‚          â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â•‘
â•‘           â”‚ (192 records)                       â”‚ (192 records)             â•‘
â•‘           â”‚ per city                           â”‚ per city                   â•‘
â•‘           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â•‘
â•‘                              â†“                                             â•‘
â•‘                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â•‘
â•‘                      â”‚ fetch_open_    â”‚                                    â•‘
â•‘                      â”‚ meteo_data()   â”‚                                    â•‘
â•‘                      â”‚  w_data        â”‚                                    â•‘
â•‘                      â”‚  aq_data       â”‚                                    â•‘
â•‘                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    EXTRACT PHASE (services/etl.py)                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  Location: services/etl.py, lines 47-59                                    â•‘
â•‘  Function: fetch_open_meteo_data(lat, lng)                                 â•‘
â•‘                                                                              â•‘
â•‘  Input:  lat (float), lng (float)                                          â•‘
â•‘  Output: (w_res dict, aq_res dict)                                         â•‘
â•‘                                                                              â•‘
â•‘  Process:                                                                   â•‘
â•‘  1. Build URLs with coordinates                                            â•‘
â•‘  2. HTTP GET requests (no auth needed)                                     â•‘
â•‘  3. Parse JSON responses                                                   â•‘
â•‘  4. Return tuple of results                                                â•‘
â•‘                                                                              â•‘
â•‘  Error Handling:                                                            â•‘
â•‘  - No retry logic (âš ï¸ TODO)                                                â•‘
â•‘  - Timeout: requests default                                               â•‘
â•‘  - Try-catch in main() catches exceptions                                  â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               TRANSFORM PHASE 1: Data Merge (services/etl.py)               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  Location: services/etl.py, lines 62-88                                    â•‘
â•‘  Function: transform_data(w_data, aq_data)                                 â•‘
â•‘                                                                              â•‘
â•‘  Step 1: Create weather DataFrame                                          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚ df_w = pd.DataFrame({                                   â”‚              â•‘
â•‘  â”‚   'time': w_data['hourly']['time'],                    â”‚              â•‘
â•‘  â”‚   'temperature': w_data['hourly']['temperature_2m'],   â”‚              â•‘
â•‘  â”‚   'humidity': w_data['hourly']['relative_humidity_2m'],â”‚              â•‘
â•‘  â”‚   'wind_speed': w_data['hourly']['wind_speed_10m']     â”‚              â•‘
â•‘  â”‚ })                                                      â”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                              â•‘
â•‘  Step 2: Create air quality DataFrame                                      â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚ df_aq = pd.DataFrame({                                  â”‚              â•‘
â•‘  â”‚   'time': aq_data['hourly']['time'],                   â”‚              â•‘
â•‘  â”‚   'pm10': aq_data['hourly']['pm10'],                   â”‚              â•‘
â•‘  â”‚   'pm25': aq_data['hourly']['pm2_5']                   â”‚              â•‘
â•‘  â”‚ })                                                      â”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                              â•‘
â•‘  Step 3: Merge on 'time' column (INNER JOIN)                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚ df = pd.merge(df_w, df_aq, on='time', how='inner')    â”‚              â•‘
â•‘  â”‚                                                         â”‚              â•‘
â•‘  â”‚ Result schema:                                          â”‚              â•‘
â•‘  â”‚  - time (str, ISO)                                     â”‚              â•‘
â•‘  â”‚  - temperature (float)                                 â”‚              â•‘
â•‘  â”‚  - humidity (float)                                    â”‚              â•‘
â•‘  â”‚  - wind_speed (float)                                  â”‚              â•‘
â•‘  â”‚  - pm10 (float)                                        â”‚              â•‘
â•‘  â”‚  - pm25 (float)                                        â”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                              â•‘
â•‘  Step 4: Data Cleaning                                                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚ Remove negative PM values (API artifacts):             â”‚              â•‘
â•‘  â”‚   df.loc[df['pm10'] < 0, 'pm10'] = None               â”‚              â•‘
â•‘  â”‚   df.loc[df['pm25'] < 0, 'pm25'] = None               â”‚              â•‘
â•‘  â”‚                                                         â”‚              â•‘
â•‘  â”‚ Convert time to timestamp:                             â”‚              â•‘
â•‘  â”‚   df['timestamp'] = pd.to_datetime(df['time'])        â”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                              â•‘
â•‘  Output: DataFrame with 6-8 columns                                        â•‘
â•‘  Rows: ~192 (8 days Ã— 24 hours)                                            â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           TRANSFORM PHASE 2: ML Prediction (services/etl.py)                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  Location: services/etl.py, lines 91-122                                   â•‘
â•‘  Function: train_and_predict_ml(df)                                        â•‘
â•‘                                                                              â•‘
â•‘  Algorithm: Linear Regression (scikit-learn)                               â•‘
â•‘                                                                              â•‘
â•‘  Step 1: Prepare training data                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚ train_df = df.dropna(subset=[                          â”‚              â•‘
â•‘  â”‚   'temperature', 'wind_speed', 'humidity', 'pm25'      â”‚              â•‘
â•‘  â”‚ ])                                                      â”‚              â•‘
â•‘  â”‚                                                         â”‚              â•‘
â•‘  â”‚ Minimum requirement: len(train_df) >= 10              â”‚              â•‘
â•‘  â”‚ If fewer: log warning, set predicted_pm25 = NULL      â”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                              â•‘
â•‘  Step 2: Define features and target                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚ Features (X):                Target (y):                â”‚              â•‘
â•‘  â”‚  - temperature (Â°C)         - pm25 (Âµg/mÂ³)             â”‚              â•‘
â•‘  â”‚  - wind_speed (km/h)                                   â”‚              â•‘
â•‘  â”‚  - humidity (%)                                        â”‚              â•‘
â•‘  â”‚                                                         â”‚              â•‘
â•‘  â”‚ X = train_df[['temperature', 'wind_speed', 'humidity']]â”‚              â•‘
â•‘  â”‚ y = train_df['pm25']                                   â”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                              â•‘
â•‘  Step 3: Train model                                                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚ model = LinearRegression()                              â”‚              â•‘
â•‘  â”‚ model.fit(X, y)                                         â”‚              â•‘
â•‘  â”‚                                                         â”‚              â•‘
â•‘  â”‚ Log RÂ² score (model.score(X, y))                       â”‚              â•‘
â•‘  â”‚  - RÂ² close to 1.0 = good fit                          â”‚              â•‘
â•‘  â”‚  - RÂ² close to 0.0 = poor fit                          â”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                              â•‘
â•‘  Step 4: Predict for all rows                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚ X_full = df[['temperature', 'wind_speed', 'humidity']]  â”‚              â•‘
â•‘  â”‚         .fillna(mean_values)  # Handle NaN for predict â”‚              â•‘
â•‘  â”‚                                                         â”‚              â•‘
â•‘  â”‚ df['predicted_pm25'] = model.predict(X_full)           â”‚              â•‘
â•‘  â”‚ df['predicted_pm25'] = df['predicted_pm25'].round(2)   â”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                              â•‘
â•‘  Output: DataFrame with additional 'predicted_pm25' column                 â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           VALIDATE PHASE: Data Quality Checks (services/etl.py)             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  Implicit validation points:                                                â•‘
â•‘                                                                              â•‘
â•‘  1. Negative values removal (Transform phase)                               â•‘
â•‘     if pm10 < 0: set to NULL âœ“                                             â•‘
â•‘     if pm25 < 0: set to NULL âœ“                                             â•‘
â•‘                                                                              â•‘
â•‘  2. Minimum data requirement (ML phase)                                     â•‘
â•‘     if len(train_df) < 10: warn and skip prediction                        â•‘
â•‘                                                                              â•‘
â•‘  3. Unique constraint (Load phase - enforced by DB)                        â•‘
â•‘     UNIQUE(city_id, timestamp) prevents duplicate rows âœ“                   â•‘
â•‘                                                                              â•‘
â•‘  Frontend validation (App.tsx):                                             â•‘
â•‘                                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚ 1. Missing data count                                   â”‚              â•‘
â•‘  â”‚    missingPM = data.filter(d => d.pm25 === null).lengthâ”‚              â•‘
â•‘  â”‚    qualityScore = 100 - (missingPM / len * 100)        â”‚              â•‘
â•‘  â”‚                                                         â”‚              â•‘
â•‘  â”‚ 2. Timestamp monotonicity                               â”‚              â•‘
â•‘  â”‚    for each pair: if curr_ts <= prev_ts: flag issue    â”‚              â•‘
â•‘  â”‚                                                         â”‚              â•‘
â•‘  â”‚ 3. Anomaly detection (spikes)                           â”‚              â•‘
â•‘  â”‚    if (curr - prev) / prev > 50%: flag anomaly         â”‚              â•‘
â•‘  â”‚                                                         â”‚              â•‘
â•‘  â”‚ 4. WHO threshold exceedance                             â”‚              â•‘
â•‘  â”‚    Group by day, find max PM25 per day                 â”‚              â•‘
â•‘  â”‚    Count days where daily_max > 15 Âµg/mÂ³               â”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                              â•‘
â•‘  Output: QA report (displayed in frontend QA tab)                          â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                LOAD PHASE: Store in Database (services/etl.py)              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  Location: services/etl.py, lines 125-180                                  â•‘
â•‘  Function: load_to_db(conn, df, city_name, lat, lng, country)             â•‘
â•‘                                                                              â•‘
â•‘  Step 1: Upsert city to dim_city                                           â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â•‘
â•‘  â”‚ INSERT INTO dim_city                                 â”‚                â•‘
â•‘  â”‚   (name, country_code, latitude, longitude)          â”‚                â•‘
â•‘  â”‚ VALUES (%s, %s, %s, %s)                              â”‚                â•‘
â•‘  â”‚ ON CONFLICT (name) DO NOTHING                        â”‚                â•‘
â•‘  â”‚ RETURNING city_id;                                   â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ If city new: INSERT and RETURN city_id              â”‚                â•‘
â•‘  â”‚ If city exists: ON CONFLICT ignored                 â”‚                â•‘
â•‘  â”‚ Fallback query: SELECT city_id FROM dim_city        â”‚                â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â•‘
â•‘                        â”‚                                                  â•‘
â•‘                        â†“ (get city_id)                                    â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â•‘
â•‘  â”‚ Step 2: Prepare tuples for batch insert              â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ weather_data = [                                     â”‚                â•‘
â•‘  â”‚   (city_id, timestamp, temp, humidity, wind_speed),  â”‚                â•‘
â•‘  â”‚   (city_id, timestamp, temp, humidity, wind_speed),  â”‚                â•‘
â•‘  â”‚   ...                                                â”‚                â•‘
â•‘  â”‚ ]                                                    â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ aq_data = [                                          â”‚                â•‘
â•‘  â”‚   (city_id, timestamp, pm10, pm25, predicted_pm25),  â”‚                â•‘
â•‘  â”‚   (city_id, timestamp, pm10, pm25, predicted_pm25),  â”‚                â•‘
â•‘  â”‚   ...                                                â”‚                â•‘
â•‘  â”‚ ]                                                    â”‚                â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â•‘
â•‘                        â”‚                                                  â•‘
â•‘                        â†“ (2x192 rows total)                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â•‘
â•‘  â”‚ Step 3: Batch insert weather data                    â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ INSERT INTO fact_weather                             â”‚                â•‘
â•‘  â”‚   (city_id, timestamp, temperature, humidity,        â”‚                â•‘
â•‘  â”‚    wind_speed)                                       â”‚                â•‘
â•‘  â”‚ VALUES %s                                            â”‚                â•‘
â•‘  â”‚ ON CONFLICT (city_id, timestamp)                     â”‚                â•‘
â•‘  â”‚ DO UPDATE SET                                        â”‚                â•‘
â•‘  â”‚   temperature=EXCLUDED.temperature,                  â”‚                â•‘
â•‘  â”‚   humidity=EXCLUDED.humidity,                        â”‚                â•‘
â•‘  â”‚   wind_speed=EXCLUDED.wind_speed;                    â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ Uses: execute_values(cursor, query, data_tuples)   â”‚                â•‘
â•‘  â”‚ Benefit: Single statement for 192 rows              â”‚                â•‘
â•‘  â”‚ Conflict: Overwrite if same city_id + timestamp     â”‚                â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â•‘
â•‘                        â”‚                                                  â•‘
â•‘                        â†“                                                  â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â•‘
â•‘  â”‚ Step 4: Batch insert air quality data                â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ INSERT INTO fact_air_quality                         â”‚                â•‘
â•‘  â”‚   (city_id, timestamp, pm10, pm25, predicted_pm25)   â”‚                â•‘
â•‘  â”‚ VALUES %s                                            â”‚                â•‘
â•‘  â”‚ ON CONFLICT (city_id, timestamp)                     â”‚                â•‘
â•‘  â”‚ DO UPDATE SET                                        â”‚                â•‘
â•‘  â”‚   pm10=EXCLUDED.pm10,                               â”‚                â•‘
â•‘  â”‚   pm25=EXCLUDED.pm25,                               â”‚                â•‘
â•‘  â”‚   predicted_pm25=EXCLUDED.predicted_pm25;            â”‚                â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â•‘
â•‘                        â”‚                                                  â•‘
â•‘                        â†“                                                  â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â•‘
â•‘  â”‚ Step 5: Commit transaction                           â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ conn.commit()  # All changes persistent              â”‚                â•‘
â•‘  â”‚ print(f"âœ“ {city_name} saved")                        â”‚                â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           DATABASE LAYER: Tables & Relationships                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â•‘
â•‘  â”‚        dim_city (Dimension)     â”‚                                      â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                      â•‘
â•‘  â”‚ city_id â”€â”€â”€â”€â”€â”€ (PK)             â”‚                                      â•‘
â•‘  â”‚ name â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ UNIQUE          â”‚â”€â”€â”€â”                                  â•‘
â•‘  â”‚ country_code â”€â”€ VARCHAR(5)      â”‚   â”‚                                  â•‘
â•‘  â”‚ latitude                        â”‚   â”‚                                  â•‘
â•‘  â”‚ longitude                       â”‚   â”‚                                  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                  â•‘
â•‘           â”‚ (FK)                       â”‚                                  â•‘
â•‘           â”‚                            â”‚                                  â•‘
â•‘     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                                  â•‘
â•‘     â†“                      â†“           â†“                                  â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘  â”‚      fact_weather (Fact Table 1)                         â”‚            â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â•‘
â•‘  â”‚ weather_id â”€â”€â”€â”€â”€â”€â”€â”€ (PK)                                 â”‚            â•‘
â•‘  â”‚ city_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (FK â†’ dim_city)                    â”‚            â•‘
â•‘  â”‚ timestamp â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ UNIQUE(city_id, timestamp)          â”‚            â•‘
â•‘  â”‚ temperature        (DECIMAL 5,2)                         â”‚            â•‘
â•‘  â”‚ humidity           (DECIMAL 5,2)                         â”‚            â•‘
â•‘  â”‚ wind_speed         (DECIMAL 5,2)                         â”‚            â•‘
â•‘  â”‚ created_at -------- (AUTO TIMESTAMP)                     â”‚            â•‘
â•‘  â”‚ [INDEX] idx_weather_time ON timestamp                    â”‚            â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘  â”‚      fact_air_quality (Fact Table 2)                     â”‚            â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â•‘
â•‘  â”‚ aq_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (PK)                                 â”‚            â•‘
â•‘  â”‚ city_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (FK â†’ dim_city)                    â”‚            â•‘
â•‘  â”‚ timestamp â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ UNIQUE(city_id, timestamp)          â”‚            â•‘
â•‘  â”‚ pm10               (DECIMAL 6,2)                         â”‚            â•‘
â•‘  â”‚ pm25               (DECIMAL 6,2)                         â”‚            â•‘
â•‘  â”‚ predicted_pm25     (DECIMAL 6,2)  â† ML output           â”‚            â•‘
â•‘  â”‚ created_at -------- (AUTO TIMESTAMP)                     â”‚            â•‘
â•‘  â”‚ [INDEX] idx_aq_time ON timestamp                         â”‚            â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘           â”‚ (LEFT JOIN)                    â”‚ (INNER JOIN)                 â•‘
â•‘           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â•‘
â•‘                                â†“                                           â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘  â”‚  dm_dashboard_analytics (SQL VIEW) â† Ğ’Ğ¸Ñ‚Ñ€Ğ¸Ğ½Ğ°             â”‚            â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â•‘
â•‘  â”‚ city_name (FROM dim_city.name)                           â”‚            â•‘
â•‘  â”‚ timestamp (FROM fact_weather)                            â”‚            â•‘
â•‘  â”‚ temperature, humidity, wind_speed (FROM fact_weather)    â”‚            â•‘
â•‘  â”‚ pm10, pm25, predicted_pm25 (FROM fact_air_quality)       â”‚            â•‘
â•‘  â”‚                                                          â”‚            â•‘
â•‘  â”‚ ORDER BY timestamp DESC                                  â”‚            â•‘
â•‘  â”‚ (Ready for API queries)                                  â”‚            â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                                                                              â•‘
â•‘  Schema Pattern: Star Schema (1 dimension, 2 facts)                       â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   API LAYER: FastAPI (server.py)                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  Server: Uvicorn ASGI                                                       â•‘
â•‘  Host: 0.0.0.0                                                              â•‘
â•‘  Port: 8000                                                                 â•‘
â•‘  CORS: Enabled for localhost:3000, localhost:5173, *                       â•‘
â•‘                                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ Endpoint: GET /                                        â”‚               â•‘
â•‘  â”‚ Purpose: Health check                                  â”‚               â•‘
â•‘  â”‚ Response: {"status": "EcoSense API is running"}        â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘                                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ Endpoint: GET /api/cities                              â”‚               â•‘
â•‘  â”‚                                                        â”‚               â•‘
â•‘  â”‚ Query:                                                 â”‚               â•‘
â•‘  â”‚   SELECT * FROM dim_city ORDER BY name                â”‚               â•‘
â•‘  â”‚                                                        â”‚               â•‘
â•‘  â”‚ Response:                                              â”‚               â•‘
â•‘  â”‚ {                                                      â”‚               â•‘
â•‘  â”‚   "cities": [                                         â”‚               â•‘
â•‘  â”‚     {                                                 â”‚               â•‘
â•‘  â”‚       "city_id": 1,                                   â”‚               â•‘
â•‘  â”‚       "name": "ĞœĞ¾ÑĞºĞ²Ğ°",                               â”‚               â•‘
â•‘  â”‚       "country_code": "RU",                           â”‚               â•‘
â•‘  â”‚       "latitude": 55.7558,                            â”‚               â•‘
â•‘  â”‚       "longitude": 37.6173                            â”‚               â•‘
â•‘  â”‚     },                                                â”‚               â•‘
â•‘  â”‚     ...                                               â”‚               â•‘
â•‘  â”‚   ]                                                   â”‚               â•‘
â•‘  â”‚ }                                                      â”‚               â•‘
â•‘  â”‚                                                        â”‚               â•‘
â•‘  â”‚ Error: 500 (DB connection error)                      â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘                                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ Endpoint: GET /api/measurements                        â”‚               â•‘
â•‘  â”‚                                                        â”‚               â•‘
â•‘  â”‚ Parameters: city_name (string, required)              â”‚               â•‘
â•‘  â”‚   Example: ?city_name=ĞœĞ¾ÑĞºĞ²Ğ°                          â”‚               â•‘
â•‘  â”‚                                                        â”‚               â•‘
â•‘  â”‚ Query:                                                 â”‚               â•‘
â•‘  â”‚   SELECT * FROM dm_dashboard_analytics                â”‚               â•‘
â•‘  â”‚   WHERE city_name = %s                                â”‚               â•‘
â•‘  â”‚   ORDER BY timestamp DESC                             â”‚               â•‘
â•‘  â”‚   LIMIT 168                                           â”‚               â•‘
â•‘  â”‚                                                        â”‚               â•‘
â•‘  â”‚ Response:                                              â”‚               â•‘
â•‘  â”‚ {                                                      â”‚               â•‘
â•‘  â”‚   "data": [                                           â”‚               â•‘
â•‘  â”‚     {                                                 â”‚               â•‘
â•‘  â”‚       "city_name": "ĞœĞ¾ÑĞºĞ²Ğ°",                          â”‚               â•‘
â•‘  â”‚       "timestamp": "2025-12-25T12:00:00",            â”‚               â•‘
â•‘  â”‚       "temperature": 5.2,                             â”‚               â•‘
â•‘  â”‚       "humidity": 72.5,                               â”‚               â•‘
â•‘  â”‚       "wind_speed": 8.3,                              â”‚               â•‘
â•‘  â”‚       "pm10": 45.2,                                   â”‚               â•‘
â•‘  â”‚       "pm25": 18.7,                                   â”‚               â•‘
â•‘  â”‚       "predicted_pm25": 19.3                          â”‚               â•‘
â•‘  â”‚     },                                                â”‚               â•‘
â•‘  â”‚     ...                                               â”‚               â•‘
â•‘  â”‚   ]                                                   â”‚               â•‘
â•‘  â”‚ }                                                      â”‚               â•‘
â•‘  â”‚                                                        â”‚               â•‘
â•‘  â”‚ Limit: 168 rows (7 days Ã— 24 hours)                  â”‚               â•‘
â•‘  â”‚ Error: 500 (DB error or no data)                      â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    CLIENT LAYER: React Frontend                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  Framework: React 19 + TypeScript + Vite                                   â•‘
â•‘  Server: Vite dev @ http://localhost:5173                                  â•‘
â•‘                                                                              â•‘
â•‘  API Client: services/api.ts                                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â•‘
â•‘  â”‚ fetchCities()                                        â”‚                â•‘
â•‘  â”‚  â†’ GET /api/cities                                   â”‚                â•‘
â•‘  â”‚  â†’ Transform to City[] (name, lat, lng, country)    â”‚                â•‘
â•‘  â”‚  â†’ Set state: cities                                 â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ fetchDashboardData(cityName)                         â”‚                â•‘
â•‘  â”‚  â†’ GET /api/measurements?city_name={cityName}        â”‚                â•‘
â•‘  â”‚  â†’ Transform to UnifiedDataPoint[]                   â”‚                â•‘
â•‘  â”‚  â†’ Add displayTime formatting                        â”‚                â•‘
â•‘  â”‚  â†’ Set state: data                                   â”‚                â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â•‘
â•‘                                                                              â•‘
â•‘  Main Component: App.tsx (440 lines)                                       â•‘
â•‘                                                                              â•‘
â•‘  State Management:                                                          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â•‘
â•‘  â”‚ const [activeView, setActiveView]                    â”‚                â•‘
â•‘  â”‚ const [cities, setCities]                            â”‚                â•‘
â•‘  â”‚ const [selectedCityName, setSelectedCityName]        â”‚                â•‘
â•‘  â”‚ const [data, setData]                                â”‚                â•‘
â•‘  â”‚ const [loading, setLoading]                          â”‚                â•‘
â•‘  â”‚ const [logs, setLogs]                                â”‚                â•‘
â•‘  â”‚ const [showMLForecast, setShowMLForecast]            â”‚                â•‘
â•‘  â”‚ const [chartMode, setChartMode]                      â”‚                â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â•‘
â•‘                                                                              â•‘
â•‘  Lifecycle:                                                                 â•‘
â•‘  1. On mount (useEffect):                                                   â•‘
â•‘     - fetchCities() â†’ populate dropdown                                     â•‘
â•‘     - Set default city                                                     â•‘
â•‘                                                                              â•‘
â•‘  2. On city change:                                                         â•‘
â•‘     - loadData() â†’ fetchDashboardData(cityName)                            â•‘
â•‘     - Transform response â†’ UnifiedDataPoint[]                              â•‘
â•‘     - Reverse array (oldest first)                                         â•‘
â•‘     - setData(result)                                                      â•‘
â•‘                                                                              â•‘
â•‘  Views (5 tabs):                                                            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â•‘
â•‘  â”‚ [Dashboard] [QA] [Data] [Logs] [Glossary]            â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ 1. Dashboard                                         â”‚                â•‘
â•‘  â”‚    - KPI cards (PM2.5, Temp, Humidity, etc.)         â”‚                â•‘
â•‘  â”‚    - TrendsChart (PM2.5 + rolling avg + WHO line)    â”‚                â•‘
â•‘  â”‚    - CorrelationMatrix (Pearson 4Ã—4)                 â”‚                â•‘
â•‘  â”‚    - TrueHeatmap (daily max PM2.5)                   â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ 2. QA Report                                         â”‚                â•‘
â•‘  â”‚    - Data quality metrics                            â”‚                â•‘
â•‘  â”‚    - Missing % / Quality Score                       â”‚                â•‘
â•‘  â”‚    - Timestamp issues                                â”‚                â•‘
â•‘  â”‚    - Anomaly count                                   â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ 3. Data Registry                                     â”‚                â•‘
â•‘  â”‚    - Sortable table view                             â”‚                â•‘
â•‘  â”‚    - All 168 rows                                    â”‚                â•‘
â•‘  â”‚    - Timestamp, all metrics                          â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ 4. Logs                                              â”‚                â•‘
â•‘  â”‚    - System operation history                        â”‚                â•‘
â•‘  â”‚    - Types: info, success, error, warning            â”‚                â•‘
â•‘  â”‚    - Timestamp + message                             â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ 5. Glossary                                          â”‚                â•‘
â•‘  â”‚    - Help documentation                              â”‚                â•‘
â•‘  â”‚    - Metric definitions                              â”‚                â•‘
â•‘  â”‚    - WHO standards                                   â”‚                â•‘
â•‘  â”‚    - Links to external resources                     â”‚                â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â•‘
â•‘                                                                              â•‘
â•‘  Visualizations (Recharts):                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â•‘
â•‘  â”‚ TrendsChart                                          â”‚                â•‘
â•‘  â”‚  - X-axis: displayTime (formatted)                   â”‚                â•‘
â•‘  â”‚  - Y-left: PM (mug/mÂ³)                               â”‚                â•‘
â•‘  â”‚  - Y-right: Temperature (mode=weather)               â”‚                â•‘
â•‘  â”‚  - Lines/Areas:                                      â”‚                â•‘
â•‘  â”‚    â€¢ PM2.5 (red area)                               â”‚                â•‘
â•‘  â”‚    â€¢ PM10 (orange, optional)                         â”‚                â•‘
â•‘  â”‚    â€¢ Rolling avg 6h (green)                          â”‚                â•‘
â•‘  â”‚    â€¢ WHO threshold 15 (red dashed)                   â”‚                â•‘
â•‘  â”‚    â€¢ AI prediction (purple dashed)                   â”‚                â•‘
â•‘  â”‚  - Modes: simple | detailed | weather                â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ CorrelationMatrix                                    â”‚                â•‘
â•‘  â”‚  - 4Ã—4 matrix                                        â”‚                â•‘
â•‘  â”‚  - Cells: PM25, Temperature, Wind, Humidity          â”‚                â•‘
â•‘  â”‚  - Values: Pearson correlation (-1 to +1)           â”‚                â•‘
â•‘  â”‚  - Colors: red (positive) to blue (negative)         â”‚                â•‘
â•‘  â”‚                                                      â”‚                â•‘
â•‘  â”‚ TrueHeatmap                                          â”‚                â•‘
â•‘  â”‚  - Daily max PM2.5                                   â”‚                â•‘
â•‘  â”‚  - Green (good) to red (bad)                         â”‚                â•‘
â•‘  â”‚  - Days on X-axis                                    â”‚                â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ”— Component Dependencies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DEPENDENCIES                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  services/etl.py requires:                                     â”‚
â”‚  â”œâ”€â”€ requests (2.31.0) - HTTP API calls                       â”‚
â”‚  â”œâ”€â”€ pandas (2.2.0) - Data transformation                      â”‚
â”‚  â”œâ”€â”€ scikit-learn (1.4.0) - ML Linear Regression              â”‚
â”‚  â”œâ”€â”€ psycopg2-binary (2.9.9) - PostgreSQL driver              â”‚
â”‚  â”œâ”€â”€ python-dotenv (1.0.0) - .env config (optional)           â”‚
â”‚  â””â”€â”€ PostgreSQL 9.6+ - Database                                â”‚
â”‚                                                                 â”‚
â”‚  server.py requires:                                           â”‚
â”‚  â”œâ”€â”€ fastapi (0.109.0) - Web framework                        â”‚
â”‚  â”œâ”€â”€ uvicorn (0.27.0) - ASGI server                           â”‚
â”‚  â”œâ”€â”€ psycopg2-binary (2.9.9) - PostgreSQL driver              â”‚
â”‚  â””â”€â”€ PostgreSQL 9.6+ - Database                                â”‚
â”‚                                                                 â”‚
â”‚  Frontend requires:                                            â”‚
â”‚  â”œâ”€â”€ react (19.2.0) - UI framework                            â”‚
â”‚  â”œâ”€â”€ react-dom (19.2.0) - React DOM utilities                 â”‚
â”‚  â”œâ”€â”€ recharts (3.5.1) - Charting library                      â”‚
â”‚  â”œâ”€â”€ lucide-react (0.555.0) - Icons                           â”‚
â”‚  â”œâ”€â”€ typescript (5.8.x) - Type system                         â”‚
â”‚  â”œâ”€â”€ vite (6.2.0) - Build tool                                â”‚
â”‚  â””â”€â”€ tailwindcss (implicit) - Styling                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Transformation Example

**Input**: Raw API response for ĞœĞ¾ÑĞºĞ²Ğ°, 2025-12-20 to 2025-12-25

**After Extract + Transform**:
```
timestamp          temperature humidity wind_speed pm10  pm25
2025-12-25 12:00   5.2          72.5    8.3        45.2  18.7
2025-12-25 11:00   4.8          71.0    8.1        44.5  18.2
2025-12-25 10:00   4.1          69.3    7.9        43.8  17.9
...
2025-12-20 00:00   -2.3         85.0    15.2       28.4  12.1
```

**After ML Prediction**:
```
timestamp          pm25  predicted_pm25 (Linear Regression)
2025-12-25 12:00   18.7  19.3
2025-12-25 11:00   18.2  18.8
2025-12-25 10:00   17.9  18.1
...
2025-12-20 00:00   12.1  12.4
```

**After Load (in PostgreSQL)**:
```
fact_weather:
  weather_id: 2891
  city_id: 1 (ĞœĞ¾ÑĞºĞ²Ğ°)
  timestamp: 2025-12-25 12:00:00
  temperature: 5.2
  humidity: 72.5
  wind_speed: 8.3
  created_at: 2025-12-25 13:45:23

fact_air_quality:
  aq_id: 2891
  city_id: 1 (ĞœĞ¾ÑĞºĞ²Ğ°)
  timestamp: 2025-12-25 12:00:00
  pm10: 45.2
  pm25: 18.7
  predicted_pm25: 19.3
  created_at: 2025-12-25 13:45:23
```

**After View Query (in Frontend)**:
```javascript
UnifiedDataPoint {
  timestamp: "2025-12-25T12:00:00",
  displayTime: "25 Ğ´ĞµĞº, 12:00",
  pm10: 45.2,
  pm25: 18.7,
  temperature: 5.2,
  humidity: 72.5,
  windSpeed: 8.3,
  predictedPM25: 19.3
}
```

---

## â±ï¸ Timing & Performance

| Stage | Component | Duration | Bottleneck |
|-------|-----------|----------|-----------|
| Extract | fetch_open_meteo_data Ã— 13 cities | ~65s | API latency |
| Transform | pandas merge + cleanup | ~2s | Data size |
| ML | LinearRegression.fit + predict | ~3s | CPU |
| Load | Batch insert Ã— 2 tables | ~5s | DB I/O |
| **Total ETL** | All stages | **~75 seconds** | API network |
| **API Query** | SELECT dm_dashboard_analytics | ~50ms | DB index |
| **Frontend Render** | React + Recharts | ~300ms | JavaScript |

---

**Document Version**: 1.0  
**Created**: 2025-12-25
